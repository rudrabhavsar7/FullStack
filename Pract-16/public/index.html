<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pract-16 â€” Contact Form</title>
    <link rel="stylesheet" href="/style.css" />
</head>

<body>
    <main class="card">
        <h1>Contact Me</h1>
        <form id="contact">
            <label>Name <input name="name" required /></label>
            <label>Email <input name="email" type="email" required /></label>
            <label>Message <textarea name="message" rows="6" required></textarea></label>
            <button type="submit">Submit</button>
        </form>
        <div id="status" class="muted"></div>
    </main>

    <script>
        const form = document.getElementById('contact');
        const status = document.getElementById('status');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            status.textContent = 'Sending...';
            const data = new FormData(form);
            const body = Object.fromEntries(data.entries());
            const res = await fetch('/contact', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            const json = await res.json();
            if (res.ok) {
                status.innerHTML = 'Message sent successfully.' + (json.preview ? `<br/><a href="${json.preview}" target="_blank">Preview message</a>` : '');
                form.reset();
            } else {
                status.textContent = json && json.error ? json.error : 'Failed to send message';
            }
        });
    </script>
</body>

</html>